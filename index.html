<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valutazione Traino (Snook-Ciriello)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select { margin-bottom: 10px; display: block; }
    .ok { color: green; font-weight: bold; }
    .warning { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Valutazione del Rischio - Traino (Metodo Snook-Ciriello)</h1>

  <label>Sesso:
    <select id="sesso">
      <option value="maschio">Maschio</option>
      <option value="femmina">Femmina</option>
    </select>
  </label>

  <label>Altezza mani (cm): <input type="number" id="altezza" value="95"></label>
  <label>Distanza (m): <input type="number" id="distanza" value="2"></label>
  <label>Frequenza (es: 1m, 5m): <input type="text" id="frequenza" value="1m"></label>
  <label>Forza Iniziale (kg): <input type="number" id="fi" step="0.1"></label>
  <label>Forza Mantenimento (kg): <input type="number" id="fm" step="0.1"></label>

  <button onclick="valuta()">Valuta Rischio</button>

  <div id="output"></div>

  <script>
    const snookData = {
      "maschio": {
        "65": {
          "2": { "1m": { "FI": 18, "FM": 12 }, "5m": { "FI": 19, "FM": 15 } },
          "5": { "1m": { "FI": 20, "FM": 14 }, "5m": { "FI": 22, "FM": 17 } }
        },
        "95": {
          "2": { "1m": { "FI": 28, "FM": 16 }, "5m": { "FI": 30, "FM": 19 } },
          "5": { "1m": { "FI": 31, "FM": 20 }, "5m": { "FI": 33, "FM": 22 } }
        }
      },
      "femmina": {
        "60": {
          "2": { "1m": { "FI": 15, "FM": 7 }, "5m": { "FI": 17, "FM": 9 } },
          "5": { "1m": { "FI": 16, "FM": 8 }, "5m": { "FI": 18, "FM": 10 } }
        },
        "90": {
          "2": { "1m": { "FI": 17, "FM": 8 }, "5m": { "FI": 19, "FM": 10 } },
          "5": { "1m": { "FI": 18, "FM": 9 }, "5m": { "FI": 20, "FM": 11 } }
        }
      }
    };

    function interpolateNumeric(x, x0, x1, y0, y1) {
      return y0 + (y1 - y0) * ((x - x0) / (x1 - x0));
    }

    function getInterpolatedValue(data, sesso, altezza, distanza, frequenza) {
      const heights = Object.keys(data[sesso]).map(Number).sort((a,b) => a - b);
      const [h0, h1] = findBounds(altezza, heights);

      const dists = Object.keys(data[sesso][h0]).map(Number).sort((a,b) => a - b);
      const [d0, d1] = findBounds(distanza, dists);

      const get = (h, d) => data[sesso][h][d][frequenza];

      const A = get(h0, d0), B = get(h0, d1), C = get(h1, d0), D = get(h1, d1);
      if (!A || !B || !C || !D) return null;

      const fi1 = interpolateNumeric(distanza, d0, d1, A.FI, B.FI);
      const fi2 = interpolateNumeric(distanza, d0, d1, C.FI, D.FI);
      const fm1 = interpolateNumeric(distanza, d0, d1, A.FM, B.FM);
      const fm2 = interpolateNumeric(distanza, d0, d1, C.FM, D.FM);

      const FI = Math.round(interpolateNumeric(altezza, h0, h1, fi1, fi2));
      const FM = Math.round(interpolateNumeric(altezza, h0, h1, fm1, fm2));

      return { FI, FM };
    }

    function findBounds(val, arr) {
      let low = arr[0], high = arr[arr.length - 1];
      for (let i = 0; i < arr.length; i++) {
        if (arr[i] >= val) {
          high = arr[i];
          low = arr[i - 1] ?? arr[i];
          break;
        }
      }
      return [low, high];
    }

    function valuta() {
      const sesso = document.getElementById("sesso").value;
      const altezza = parseFloat(document.getElementById("altezza").value);
      const distanza = parseFloat(document.getElementById("distanza").value);
      const frequenza = document.getElementById("frequenza").value;
      const fi = parseFloat(document.getElementById("fi").value);
      const fm = parseFloat(document.getElementById("fm").value);

      const result = getInterpolatedValue(snookData, sesso, altezza, distanza, frequenza);
      if (!result) {
        document.getElementById("output").innerHTML = "<p class='warning'>‚ö†Ô∏è Combinazione non disponibile o frequenza mancante.</p>";
        return;
      }

      let msg = `<p><em>(Interpolato)</em> Limiti FI/FM stimati per ${altezza}cm, ${distanza}m, ${frequenza}: <strong>${result.FI} / ${result.FM} kg</strong></p>`;
      msg += `<p>Valori inseriti: <strong>${fi} / ${fm} kg</strong></p>`;
      msg += (fi > result.FI || fm > result.FM)
        ? "<p class='warning'>üö® RISCHIO: superati i limiti consigliati.</p>"
        : "<p class='ok'>‚úÖ OK: valori entro i limiti.</p>";

      document.getElementById("output").innerHTML = msg;
    }
  </script>
</body>
</html>
